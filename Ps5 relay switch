#include <ps5Controller.h>

#define RELAY_ON_CMD  "ON\n"
#define RELAY_OFF_CMD "OFF\n"

HardwareSerial nanoSerial(1); // TX/RX to Nano
#define TX_PIN 16
#define RX_PIN 17

void setup() {
  Serial.begin(115200);
  nanoSerial.begin(115200, SERIAL_8N1, RX_PIN, TX_PIN);

  Serial.println("ESP32 ready. Connecting to PS5...");

  ps5.attachOnConnect([]() { Serial.println("[PS5] Connected!"); });
  ps5.attachOnDisconnect([]() { Serial.println("[PS5] Disconnected!"); });

  // Replace with your PS5 controller's Bluetooth MAC
  const char* ps5MAC = "90:b6:85:16:55:b1"; 
  ps5.begin(ps5MAC);  // Initiate connection using MAC
}

void loop() {
  if (!ps5.isConnected()) return;

  if (ps5.Cross()) {
    Serial.println("[PS5] Relay ON");
    nanoSerial.print(RELAY_ON_CMD);
    delay(200);
  }

  if (ps5.Circle()) {
    Serial.println("[PS5] Relay OFF");
    nanoSerial.print(RELAY_OFF_CMD);
    delay(200);
  }
}
